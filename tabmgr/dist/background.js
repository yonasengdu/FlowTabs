(()=>{"use strict";var t={515:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.COMMAND_NAME=e.DELAYS=e.THUMBNAIL_QUALITY=e.CHROME_PROTOCOL=void 0,e.CHROME_PROTOCOL="chrome://",e.THUMBNAIL_QUALITY={HIGH:50,LOW:40},e.DELAYS={PRELOAD:1e3,TAB_CAPTURE:500},e.COMMAND_NAME="alt-q-switch"},795:function(t,e,a){var i=this&&this.__awaiter||function(t,e,a,i){return new(a||(a=Promise))(function(n,r){function s(t){try{d(i.next(t))}catch(t){r(t)}}function o(t){try{d(i.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a(function(t){t(e)})).then(s,o)}d((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.preloadAllTabThumbnails=e.captureAndCacheTab=e.getTabDetails=e.removeTabFromMru=e.updateMruList=e.initializeMruList=e.tabManager=void 0;const n=a(839),r=a(515);e.tabManager=new class{constructor(){this.mruTabIds=[],this.thumbnailCache=new Map,this.isInitialized=!1}initialize(){return i(this,void 0,void 0,function*(){const t=yield chrome.tabs.query({}),e=new Set(t.map(t=>t.id).filter(t=>void 0!==t));yield this.initializeMruList(t,e),yield this.loadCachedData(e),yield n.StorageManager.cleanClosedTabs(e),this.isInitialized=!0})}initializeMruList(t,e){return i(this,void 0,void 0,function*(){const a=yield n.StorageManager.getMruList();a.length>0?(this.mruTabIds=a.filter(t=>e.has(t)),this.addNewTabsToMruList(t,e)):this.mruTabIds=t.map(t=>t.id).filter(t=>void 0!==t),yield n.StorageManager.saveMruList(this.mruTabIds)})}addNewTabsToMruList(t,e){const a=new Set(this.mruTabIds),i=t.filter(t=>t.id&&!a.has(t.id));this.mruTabIds=[...this.mruTabIds,...i.map(t=>t.id)]}loadCachedData(t){return i(this,void 0,void 0,function*(){const e=yield n.StorageManager.getThumbnails();for(const[a,i]of Object.entries(e)){const e=parseInt(a,10);t.has(e)&&this.thumbnailCache.set(e,i)}})}updateMruList(t){this.mruTabIds=this.mruTabIds.filter(e=>e!==t),this.mruTabIds.unshift(t),n.StorageManager.saveMruList(this.mruTabIds)}removeTab(t){return i(this,void 0,void 0,function*(){this.mruTabIds=this.mruTabIds.filter(e=>e!==t),this.thumbnailCache.delete(t),yield Promise.all([n.StorageManager.removeThumbnail(t),n.StorageManager.removeTabData(t)]),yield n.StorageManager.saveMruList(this.mruTabIds)})}getTabDetails(){return i(this,void 0,void 0,function*(){yield this.ensureInitialized(),yield this.syncMruListWithOpenTabs();const t=yield chrome.tabs.query({windowType:"normal"}),e=new Map(t.map(t=>[t.id,t])),[a,i]=yield Promise.all([n.StorageManager.getThumbnails(),n.StorageManager.getTabData()]);return this.mruTabIds.map(t=>this.createTabInfo(t,e,a,i)).filter(t=>null!==t)})}ensureInitialized(){return i(this,void 0,void 0,function*(){this.isInitialized||(yield this.initialize())})}syncMruListWithOpenTabs(){return i(this,void 0,void 0,function*(){const t=yield chrome.tabs.query({windowType:"normal"}),e=(new Set(t.map(t=>t.id).filter(t=>void 0!==t)),new Set(this.mruTabIds)),a=t.filter(t=>t.id&&!e.has(t.id));a.length>0&&(this.mruTabIds=[...this.mruTabIds,...a.map(t=>t.id)],yield n.StorageManager.saveMruList(this.mruTabIds))})}createTabInfo(t,e,a,i){const n=e.get(t);if(!n)return null;const r=i[t.toString()],s=this.getThumbnailUrl(t,a);return{id:n.id,title:(null==r?void 0:r.title)||n.title,url:(null==r?void 0:r.url)||n.url,favIconUrl:(null==r?void 0:r.favIconUrl)||n.favIconUrl,thumbnailUrl:s||(null==r?void 0:r.thumbnailUrl)||void 0}}getThumbnailUrl(t,e){let a=this.thumbnailCache.get(t);return!a&&e[t.toString()]&&(a=e[t.toString()],this.thumbnailCache.set(t,a)),a}captureAndCacheTab(t){return i(this,void 0,void 0,function*(){try{const e=yield chrome.tabs.get(t);if(!this.canCaptureTab(e))return;const a=yield chrome.tabs.captureVisibleTab(e.windowId,{format:"jpeg",quality:r.THUMBNAIL_QUALITY.HIGH});a&&(yield this.saveTabCapture(t,e,a))}catch(e){console.warn(`Could not capture tab ${t}: ${e.message}`)}})}canCaptureTab(t){return!0===t.active&&void 0!==t.url&&!t.url.startsWith(r.CHROME_PROTOCOL)&&void 0!==t.windowId}saveTabCapture(t,e,a){return i(this,void 0,void 0,function*(){this.thumbnailCache.set(t,a);const i={id:e.id,title:e.title,url:e.url,favIconUrl:e.favIconUrl,thumbnailUrl:a};yield Promise.all([n.StorageManager.saveThumbnail(t,a),n.StorageManager.saveTabData(t,i)])})}preloadAllTabThumbnails(){return i(this,void 0,void 0,function*(){try{const t=(yield chrome.windows.getAll({populate:!0})).map(t=>this.processWindow(t));yield Promise.allSettled(t)}catch(t){}})}processWindow(t){return i(this,void 0,void 0,function*(){if(!t.tabs)return;const e=t.tabs.find(t=>t.active);e&&this.canCaptureTab(e)&&(yield this.captureActiveTab(t.id,e)),yield this.saveAllTabData(t.tabs)})}captureActiveTab(t,e){return i(this,void 0,void 0,function*(){try{const a=yield chrome.tabs.captureVisibleTab(t,{format:"jpeg",quality:r.THUMBNAIL_QUALITY.LOW});a&&e.id&&(yield this.saveTabCapture(e.id,e,a))}catch(t){}})}saveAllTabData(t){return i(this,void 0,void 0,function*(){const e=t.filter(t=>t.id&&t.url&&!t.url.startsWith(r.CHROME_PROTOCOL)).map(t=>this.saveTabDataOnly(t));yield Promise.allSettled(e)})}saveTabDataOnly(t){return i(this,void 0,void 0,function*(){if(t.id)try{const e={id:t.id,title:t.title,url:t.url,favIconUrl:t.favIconUrl,thumbnailUrl:void 0};yield n.StorageManager.saveTabData(t.id,e)}catch(t){}})}},e.initializeMruList=()=>e.tabManager.initialize(),e.updateMruList=t=>e.tabManager.updateMruList(t),e.removeTabFromMru=t=>e.tabManager.removeTab(t),e.getTabDetails=()=>e.tabManager.getTabDetails(),e.captureAndCacheTab=t=>e.tabManager.captureAndCacheTab(t),e.preloadAllTabThumbnails=()=>e.tabManager.preloadAllTabThumbnails()},839:function(t,e){var a=this&&this.__awaiter||function(t,e,a,i){return new(a||(a=Promise))(function(n,r){function s(t){try{d(i.next(t))}catch(t){r(t)}}function o(t){try{d(i.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a(function(t){t(e)})).then(s,o)}d((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.StorageManager=void 0;const i="mruTabIds",n="tabThumbnails",r="tabData";e.StorageManager=class{static getMruList(){return a(this,void 0,void 0,function*(){return(yield chrome.storage.local.get(i))[i]||[]})}static saveMruList(t){return a(this,void 0,void 0,function*(){yield chrome.storage.local.set({[i]:t})})}static getThumbnails(){return a(this,void 0,void 0,function*(){return(yield chrome.storage.local.get(n))[n]||{}})}static saveThumbnail(t,e){return a(this,void 0,void 0,function*(){const a=yield this.getThumbnails();a[t.toString()]=e,yield chrome.storage.local.set({[n]:a})})}static removeThumbnail(t){return a(this,void 0,void 0,function*(){const e=yield this.getThumbnails();delete e[t.toString()],yield chrome.storage.local.set({[n]:e})})}static getTabData(){return a(this,void 0,void 0,function*(){return(yield chrome.storage.local.get(r))[r]||{}})}static saveTabData(t,e){return a(this,void 0,void 0,function*(){const a=yield this.getTabData();a[t.toString()]=e,yield chrome.storage.local.set({[r]:a})})}static removeTabData(t){return a(this,void 0,void 0,function*(){const e=yield this.getTabData();delete e[t.toString()],yield chrome.storage.local.set({[r]:e})})}static cleanClosedTabs(t){return a(this,void 0,void 0,function*(){const[e,a]=yield Promise.all([this.getThumbnails(),this.getTabData()]),i=this.filterByOpenTabs(e,t),s=this.filterByOpenTabs(a,t);yield Promise.all([chrome.storage.local.set({[n]:i}),chrome.storage.local.set({[r]:s})])})}static filterByOpenTabs(t,e){const a={};for(const[i,n]of Object.entries(t)){const t=parseInt(i,10);e.has(t)&&(a[i]=n)}return a}}},910:function(t,e,a){var i=this&&this.__awaiter||function(t,e,a,i){return new(a||(a=Promise))(function(n,r){function s(t){try{d(i.next(t))}catch(t){r(t)}}function o(t){try{d(i.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a(function(t){t(e)})).then(s,o)}d((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.EventHandlers=void 0;const n=a(795),r=a(515);e.EventHandlers=class{static handleStartup(){return i(this,void 0,void 0,function*(){yield n.tabManager.initialize(),setTimeout(()=>n.tabManager.preloadAllTabThumbnails(),r.DELAYS.PRELOAD)})}static handleInstalled(){return i(this,void 0,void 0,function*(){yield n.tabManager.initialize(),setTimeout(()=>n.tabManager.preloadAllTabThumbnails(),r.DELAYS.PRELOAD)})}static handleTabActivated(t){return i(this,void 0,void 0,function*(){n.tabManager.updateMruList(t.tabId),yield n.tabManager.captureAndCacheTab(t.tabId)})}static handleTabUpdated(t,e,a){return i(this,void 0,void 0,function*(){this.shouldCaptureTab(e,a)&&(yield n.tabManager.captureAndCacheTab(t))})}static handleTabRemoved(t){n.tabManager.removeTab(t)}static handleTabCreated(t){return i(this,void 0,void 0,function*(){t.id&&n.tabManager.updateMruList(t.id),this.shouldPreloadNewTab(t)&&setTimeout(()=>i(this,void 0,void 0,function*(){const e=yield chrome.tabs.get(t.id);e.active&&"complete"===e.status&&(yield n.tabManager.captureAndCacheTab(t.id))}),r.DELAYS.TAB_CAPTURE)})}static shouldCaptureTab(t,e){return"complete"===t.status&&!0===e.active&&void 0!==e.url&&!e.url.startsWith(r.CHROME_PROTOCOL)}static shouldPreloadNewTab(t){return void 0!==t.id&&void 0!==t.url&&!t.url.startsWith(r.CHROME_PROTOCOL)&&!0===t.active}}},922:function(t,e,a){var i=this&&this.__awaiter||function(t,e,a,i){return new(a||(a=Promise))(function(n,r){function s(t){try{d(i.next(t))}catch(t){r(t)}}function o(t){try{d(i.throw(t))}catch(t){r(t)}}function d(t){var e;t.done?n(t.value):(e=t.value,e instanceof a?e:new a(function(t){t(e)})).then(s,o)}d((i=i.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const n=a(795),r=a(910),s=a(515);chrome.runtime.onStartup.addListener(()=>r.EventHandlers.handleStartup()),chrome.runtime.onInstalled.addListener(()=>r.EventHandlers.handleInstalled()),chrome.tabs.onActivated.addListener(t=>r.EventHandlers.handleTabActivated(t)),chrome.tabs.onUpdated.addListener((t,e,a)=>r.EventHandlers.handleTabUpdated(t,e,a)),chrome.tabs.onRemoved.addListener(t=>r.EventHandlers.handleTabRemoved(t)),chrome.tabs.onCreated.addListener(t=>r.EventHandlers.handleTabCreated(t)),chrome.runtime.onConnect.addListener(t=>{t.name}),chrome.commands.onCommand.addListener(t=>i(void 0,void 0,void 0,function*(){if(t!==s.COMMAND_NAME)return;const[e]=yield chrome.tabs.query({active:!0,currentWindow:!0});var a;if(void 0!==(null==(a=e)?void 0:a.id)&&void 0!==a.url&&!a.url.startsWith(s.CHROME_PROTOCOL))try{yield chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js"]});const t={type:"shortcut-pressed"};chrome.tabs.sendMessage(e.id,t)}catch(t){console.warn(`Alt+Q: Could not inject script: ${t.message}`)}})),chrome.runtime.onMessage.addListener((t,e,a)=>{if("capture-and-get-list"===t.type)return function(t,e){i(this,void 0,void 0,function*(){var a;try{if(!(null===(a=t.tab)||void 0===a?void 0:a.id))return void e([]);yield n.tabManager.captureAndCacheTab(t.tab.id);const i=yield n.tabManager.getTabDetails();e(i),n.tabManager.preloadAllTabThumbnails().catch(()=>{})}catch(t){console.error("Error handling capture-and-get-list:",t),e([])}})}(e,a),!0;"switch-to-tab"===t.type&&chrome.tabs.update(t.tabId,{active:!0})})}},e={};!function a(i){var n=e[i];if(void 0!==n)return n.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,a),r.exports}(922)})();