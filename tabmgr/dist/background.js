(()=>{"use strict";var t={194:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.container=void 0;const r=i(828),o=i(718),n=i(855),a=i(769),s=i(358),d=i(559);e.container=new r.Container,e.container.singleton(o.SERVICE_KEYS.TAB_REPOSITORY,()=>new n.ChromeTabRepository),e.container.singleton(o.SERVICE_KEYS.STORAGE_REPOSITORY,()=>new a.ChromeStorageRepository),e.container.singleton(o.SERVICE_KEYS.THUMBNAIL_REPOSITORY,()=>{const t=e.container.resolve(o.SERVICE_KEYS.STORAGE_REPOSITORY);return new s.ThumbnailRepository(t)}),e.container.singleton(o.SERVICE_KEYS.TAB_SERVICE,()=>{const t=e.container.resolve(o.SERVICE_KEYS.TAB_REPOSITORY),i=e.container.resolve(o.SERVICE_KEYS.STORAGE_REPOSITORY),r=e.container.resolve(o.SERVICE_KEYS.THUMBNAIL_REPOSITORY);return new d.TabService(t,i,r)})},358:function(t,e){var i=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function a(t){try{d(r.next(t))}catch(t){n(t)}}function s(t){try{d(r.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}d((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.ThumbnailRepository=void 0,e.ThumbnailRepository=class{constructor(t){this.storageRepository=t,this.cache=new Map}getThumbnail(t){return i(this,void 0,void 0,function*(){const e=this.cache.get(t);if(e)return e;const i=(yield this.storageRepository.getThumbnails())[t.toString()];return i&&this.cache.set(t,i),i})}saveThumbnail(t,e){return i(this,void 0,void 0,function*(){this.cache.set(t,e),yield this.storageRepository.saveThumbnail(t,e)})}removeThumbnail(t){return i(this,void 0,void 0,function*(){this.cache.delete(t),yield this.storageRepository.removeThumbnail(t)})}getCachedThumbnail(t){return this.cache.get(t)}cacheThumbnail(t,e){this.cache.set(t,e)}}},515:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.COMMAND_NAME=e.DELAYS=e.THUMBNAIL_QUALITY=e.CHROME_PROTOCOL=void 0,e.CHROME_PROTOCOL="chrome://",e.THUMBNAIL_QUALITY={HIGH:50,LOW:40},e.DELAYS={PRELOAD:1e3,TAB_CAPTURE:500},e.COMMAND_NAME="alt-q-switch"},559:function(t,e,i){var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function a(t){try{d(r.next(t))}catch(t){n(t)}}function s(t){try{d(r.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}d((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.TabService=void 0;const o=i(515);e.TabService=class{constructor(t,e,i){this.tabRepository=t,this.storageRepository=e,this.thumbnailRepository=i,this.mruTabIds=new Map,this.mruOrder=0,this.isInitialized=!1}getMruArray(){return Array.from(this.mruTabIds.keys())}initialize(){return r(this,void 0,void 0,function*(){const t=yield this.tabRepository.getAllTabs(),e=new Set(t.map(t=>t.id).filter(t=>void 0!==t));yield this.initializeMruList(t,e),yield this.loadCachedData(e),yield this.storageRepository.cleanClosedTabs(e),this.isInitialized=!0})}getTabDetails(){return r(this,void 0,void 0,function*(){yield this.ensureInitialized(),yield this.syncMruListWithOpenTabs();const t=yield this.tabRepository.getTabsByWindowType("normal"),e=new Map(t.map(t=>[t.id,t])),i=yield this.storageRepository.getTabData();return Array.from(this.mruTabIds.keys()).map(t=>this.createTabInfo(t,e,i)).filter(t=>null!==t)})}updateMruList(t){return r(this,void 0,void 0,function*(){this.mruTabIds.delete(t),this.mruTabIds.set(t,this.mruOrder++),yield this.storageRepository.saveMruList(this.getMruArray())})}removeTab(t){return r(this,void 0,void 0,function*(){this.mruTabIds.delete(t),this.thumbnailRepository.removeThumbnail(t),yield Promise.all([this.storageRepository.removeThumbnail(t),this.storageRepository.removeTabData(t)]),yield this.storageRepository.saveMruList(this.getMruArray())})}captureAndCacheTab(t){return r(this,void 0,void 0,function*(){try{const e=yield this.tabRepository.getTabById(t);if(!this.canCaptureTab(e))return;const i=yield this.tabRepository.captureVisibleTab(e.windowId,{format:"jpeg",quality:o.THUMBNAIL_QUALITY.HIGH});i&&(yield this.saveTabCapture(t,e,i))}catch(e){console.warn(`Could not capture tab ${t}: ${e.message}`)}})}preloadAllTabThumbnails(){return r(this,void 0,void 0,function*(){try{const t=(yield this.tabRepository.getAllWindows()).map(t=>this.processWindow(t));yield Promise.allSettled(t)}catch(t){}})}initializeMruList(t,e){return r(this,void 0,void 0,function*(){const i=yield this.storageRepository.getMruList();if(i.length>0){for(const t of i)e.has(t)&&this.mruTabIds.set(t,this.mruOrder++);this.addNewTabsToMruList(t,e)}else for(const e of t)e.id&&this.mruTabIds.set(e.id,this.mruOrder++);yield this.storageRepository.saveMruList(this.getMruArray())})}addNewTabsToMruList(t,e){for(const i of t)i.id&&!this.mruTabIds.has(i.id)&&e.has(i.id)&&this.mruTabIds.set(i.id,this.mruOrder++)}loadCachedData(t){return r(this,void 0,void 0,function*(){const e=yield this.storageRepository.getThumbnails();for(const[i,r]of Object.entries(e)){const e=parseInt(i,10);t.has(e)&&this.thumbnailRepository.cacheThumbnail(e,r)}})}ensureInitialized(){return r(this,void 0,void 0,function*(){this.isInitialized||(yield this.initialize())})}syncMruListWithOpenTabs(){return r(this,void 0,void 0,function*(){const t=yield this.tabRepository.getTabsByWindowType("normal");let e=!1;for(const i of t)i.id&&!this.mruTabIds.has(i.id)&&(this.mruTabIds.set(i.id,this.mruOrder++),e=!0);e&&(yield this.storageRepository.saveMruList(this.getMruArray()))})}createTabInfo(t,e,i){const r=e.get(t);if(!r)return null;const o=i[t.toString()],n=this.thumbnailRepository.getCachedThumbnail(t);return{id:r.id,title:(null==o?void 0:o.title)||r.title,url:(null==o?void 0:o.url)||r.url,favIconUrl:(null==o?void 0:o.favIconUrl)||r.favIconUrl,thumbnailUrl:n||(null==o?void 0:o.thumbnailUrl)||void 0}}canCaptureTab(t){return!0===t.active&&void 0!==t.url&&!t.url.startsWith(o.CHROME_PROTOCOL)&&void 0!==t.windowId}saveTabCapture(t,e,i){return r(this,void 0,void 0,function*(){this.thumbnailRepository.cacheThumbnail(t,i);const r={id:e.id,title:e.title,url:e.url,favIconUrl:e.favIconUrl,thumbnailUrl:i};yield Promise.all([this.storageRepository.saveThumbnail(t,i),this.storageRepository.saveTabData(t,r)])})}processWindow(t){return r(this,void 0,void 0,function*(){if(!t.tabs)return;const e=t.tabs.find(t=>t.active);e&&this.canCaptureTab(e)&&(yield this.captureActiveTab(t.id,e)),yield this.saveAllTabData(t.tabs)})}captureActiveTab(t,e){return r(this,void 0,void 0,function*(){try{const i=yield this.tabRepository.captureVisibleTab(t,{format:"jpeg",quality:o.THUMBNAIL_QUALITY.LOW});i&&e.id&&(yield this.saveTabCapture(e.id,e,i))}catch(t){}})}saveAllTabData(t){return r(this,void 0,void 0,function*(){const e=t.filter(t=>t.id&&t.url&&!t.url.startsWith(o.CHROME_PROTOCOL)).map(t=>this.saveTabDataOnly(t));yield Promise.allSettled(e)})}saveTabDataOnly(t){return r(this,void 0,void 0,function*(){if(t.id)try{const e={id:t.id,title:t.title,url:t.url,favIconUrl:t.favIconUrl,thumbnailUrl:void 0};yield this.storageRepository.saveTabData(t.id,e)}catch(t){}})}}},718:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SERVICE_KEYS=void 0,e.SERVICE_KEYS={TAB_REPOSITORY:"TabRepository",STORAGE_REPOSITORY:"StorageRepository",THUMBNAIL_REPOSITORY:"ThumbnailRepository",TAB_SERVICE:"TabService"}},769:function(t,e){var i=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function a(t){try{d(r.next(t))}catch(t){n(t)}}function s(t){try{d(r.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}d((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.ChromeStorageRepository=void 0;const r="mruTabIds",o="tabThumbnails",n="tabData";e.ChromeStorageRepository=class{getMruList(){return i(this,void 0,void 0,function*(){return(yield chrome.storage.local.get(r))[r]||[]})}saveMruList(t){return i(this,void 0,void 0,function*(){yield chrome.storage.local.set({[r]:t})})}getThumbnails(){return i(this,void 0,void 0,function*(){return(yield chrome.storage.local.get(o))[o]||{}})}saveThumbnail(t,e){return i(this,void 0,void 0,function*(){const i=yield this.getThumbnails();i[t.toString()]=e,yield chrome.storage.local.set({[o]:i})})}removeThumbnail(t){return i(this,void 0,void 0,function*(){const e=yield this.getThumbnails();delete e[t.toString()],yield chrome.storage.local.set({[o]:e})})}getTabData(){return i(this,void 0,void 0,function*(){return(yield chrome.storage.local.get(n))[n]||{}})}saveTabData(t,e){return i(this,void 0,void 0,function*(){const i=yield this.getTabData();i[t.toString()]=e,yield chrome.storage.local.set({[n]:i})})}removeTabData(t){return i(this,void 0,void 0,function*(){const e=yield this.getTabData();delete e[t.toString()],yield chrome.storage.local.set({[n]:e})})}cleanClosedTabs(t){return i(this,void 0,void 0,function*(){const[e,i]=yield Promise.all([this.getThumbnails(),this.getTabData()]),r=this.filterByOpenTabs(e,t),a=this.filterByOpenTabs(i,t);yield Promise.all([chrome.storage.local.set({[o]:r}),chrome.storage.local.set({[n]:a})])})}filterByOpenTabs(t,e){const i={};for(const[r,o]of Object.entries(t)){const t=parseInt(r,10);e.has(t)&&(i[r]=o)}return i}}},828:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0,e.Container=class{constructor(){this.services=new Map}register(t,e){this.services.set(t,e)}resolve(t){const e=this.services.get(t);if(!e)throw new Error(`Service ${t} not found`);return e()}singleton(t,e){let i=null;this.register(t,()=>(i||(i=e()),i))}}},855:function(t,e){var i=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function a(t){try{d(r.next(t))}catch(t){n(t)}}function s(t){try{d(r.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}d((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.ChromeTabRepository=void 0,e.ChromeTabRepository=class{getAllTabs(){return i(this,void 0,void 0,function*(){return chrome.tabs.query({})})}getTabById(t){return i(this,void 0,void 0,function*(){return chrome.tabs.get(t)})}getTabsByWindowType(t){return i(this,void 0,void 0,function*(){return chrome.tabs.query({windowType:t})})}updateTab(t,e){return i(this,void 0,void 0,function*(){return chrome.tabs.update(t,e)})}captureVisibleTab(t,e){return i(this,void 0,void 0,function*(){return chrome.tabs.captureVisibleTab(t,e)})}getAllWindows(){return i(this,void 0,void 0,function*(){return chrome.windows.getAll({populate:!0})})}}},910:function(t,e,i){var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function a(t){try{d(r.next(t))}catch(t){n(t)}}function s(t){try{d(r.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}d((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.EventHandlers=void 0;const o=i(515),n=i(194),a=i(718);class s{static initialize(){this.tabService=n.container.resolve(a.SERVICE_KEYS.TAB_SERVICE)}static getTabService(){return this.tabService||(this.tabService=n.container.resolve(a.SERVICE_KEYS.TAB_SERVICE)),this.tabService}static handleStartup(){return r(this,void 0,void 0,function*(){const t=this.getTabService();yield t.initialize(),setTimeout(()=>t.preloadAllTabThumbnails(),o.DELAYS.PRELOAD)})}static handleInstalled(){return r(this,void 0,void 0,function*(){const t=this.getTabService();yield t.initialize(),setTimeout(()=>t.preloadAllTabThumbnails(),o.DELAYS.PRELOAD)})}static handleTabActivated(t){return r(this,void 0,void 0,function*(){const e=this.getTabService();yield e.updateMruList(t.tabId),yield e.captureAndCacheTab(t.tabId)})}static handleTabUpdated(t,e,i){return r(this,void 0,void 0,function*(){if(this.shouldCaptureTab(e,i)){const e=this.getTabService();yield e.captureAndCacheTab(t)}})}static handleTabRemoved(t){return r(this,void 0,void 0,function*(){const e=this.getTabService();yield e.removeTab(t)})}static handleTabCreated(t){return r(this,void 0,void 0,function*(){const e=this.getTabService();t.id&&(yield e.updateMruList(t.id)),this.shouldPreloadNewTab(t)&&setTimeout(()=>r(this,void 0,void 0,function*(){const i=yield chrome.tabs.get(t.id);i.active&&"complete"===i.status&&(yield e.captureAndCacheTab(t.id))}),o.DELAYS.TAB_CAPTURE)})}static shouldCaptureTab(t,e){return"complete"===t.status&&!0===e.active&&void 0!==e.url&&!e.url.startsWith(o.CHROME_PROTOCOL)}static shouldPreloadNewTab(t){return void 0!==t.id&&void 0!==t.url&&!t.url.startsWith(o.CHROME_PROTOCOL)&&!0===t.active}}e.EventHandlers=s,s.tabService=null},922:function(t,e,i){var r=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function a(t){try{d(r.next(t))}catch(t){n(t)}}function s(t){try{d(r.throw(t))}catch(t){n(t)}}function d(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,s)}d((r=r.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const o=i(910),n=i(515),a=i(194),s=i(718),d=new Set;o.EventHandlers.initialize(),chrome.runtime.onStartup.addListener(()=>o.EventHandlers.handleStartup()),chrome.runtime.onInstalled.addListener(()=>o.EventHandlers.handleInstalled()),chrome.tabs.onActivated.addListener(t=>o.EventHandlers.handleTabActivated(t)),chrome.tabs.onUpdated.addListener((t,e,i)=>{o.EventHandlers.handleTabUpdated(t,e,i),e.url&&d.delete(t)}),chrome.tabs.onRemoved.addListener(t=>{o.EventHandlers.handleTabRemoved(t),d.delete(t)}),chrome.tabs.onCreated.addListener(t=>o.EventHandlers.handleTabCreated(t)),chrome.runtime.onConnect.addListener(t=>{t.name}),chrome.commands.onCommand.addListener(t=>r(void 0,void 0,void 0,function*(){if(t!==n.COMMAND_NAME)return;const[e]=yield chrome.tabs.query({active:!0,currentWindow:!0});if(void 0===(null==(i=e)?void 0:i.id)||void 0===i.url||i.url.startsWith(n.CHROME_PROTOCOL)||!e.id)return;var i;const r=e.id,o={type:"shortcut-pressed"};if(d.has(r))chrome.tabs.sendMessage(r,o).catch(()=>{d.delete(r)});else try{yield chrome.tabs.sendMessage(r,o),d.add(r)}catch(t){try{yield chrome.scripting.executeScript({target:{tabId:r},files:["content.js"]}),d.add(r),chrome.tabs.sendMessage(r,o).catch(()=>{})}catch(t){console.warn(`Alt+Q: Could not inject script: ${t.message}`)}}})),chrome.runtime.onMessage.addListener((t,e,i)=>{if("capture-and-get-list"===t.type)return function(t,e){r(this,void 0,void 0,function*(){var i;try{if(!(null===(i=t.tab)||void 0===i?void 0:i.id))return void e([]);const r=a.container.resolve(s.SERVICE_KEYS.TAB_SERVICE);yield r.captureAndCacheTab(t.tab.id);const o=yield r.getTabDetails();e(o),r.preloadAllTabThumbnails().catch(()=>{})}catch(t){console.error("Error handling capture-and-get-list:",t),e([])}})}(e,i),!0;"switch-to-tab"===t.type&&function(t){r(this,void 0,void 0,function*(){try{const e=a.container.resolve(s.SERVICE_KEYS.TAB_SERVICE),i=a.container.resolve(s.SERVICE_KEYS.TAB_REPOSITORY);yield e.updateMruList(t),yield i.updateTab(t,{active:!0})}catch(t){console.error("Error switching to tab:",t)}})}(t.tabId)})}},e={};!function i(r){var o=e[r];if(void 0!==o)return o.exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}(922)})();