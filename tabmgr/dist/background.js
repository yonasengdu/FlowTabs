(()=>{"use strict";var t={795:function(t,e){var i=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function a(t){try{l(o.next(t))}catch(t){r(t)}}function c(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,c)}l((o=o.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.initializeMruList=s,e.updateMruList=function(t){o=o.filter(e=>e!==t),o.unshift(t),d()},e.removeTabFromMru=function(t){o=o.filter(e=>e!==t),n.delete(t),function(t){i(this,void 0,void 0,function*(){try{const e=yield chrome.storage.local.get(c);if(e[c]){const i=e[c];delete i[t.toString()],yield chrome.storage.local.set({[c]:i})}}catch(t){console.warn(`Could not remove thumbnail from storage: ${t.message}`)}})}(t),function(t){i(this,void 0,void 0,function*(){try{const e=yield chrome.storage.local.get(l);if(e[l]){const i=e[l];delete i[t.toString()],yield chrome.storage.local.set({[l]:i})}}catch(t){console.warn(`Could not remove tab data from storage: ${t.message}`)}})}(t),d()},e.getTabDetails=function(){return i(this,void 0,void 0,function*(){r||(yield s());const t=yield chrome.tabs.query({windowType:"normal"}),e=new Map(t.map(t=>[t.id,t])),i=(new Set(t.map(t=>t.id)),new Set(o)),a=t.filter(t=>t.id&&!i.has(t.id));a.length>0&&(o=[...o,...a.map(t=>t.id)],d());const u=yield chrome.storage.local.get([c,l]),h=u[c],f=u[l];return o.map(t=>{const i=e.get(t);if(!i)return null;const o=null==f?void 0:f[t.toString()];let r=n.get(t);return!r&&h&&(r=h[t.toString()],r&&n.set(t,r)),{id:i.id,title:(null==o?void 0:o.title)||i.title,url:(null==o?void 0:o.url)||i.url,favIconUrl:(null==o?void 0:o.favIconUrl)||i.favIconUrl,thumbnailUrl:r||(null==o?void 0:o.thumbnailUrl)||void 0}}).filter(t=>!!t)})},e.captureAndCacheTab=function(t){return i(this,void 0,void 0,function*(){var e;try{const i=yield chrome.tabs.get(t);if(!i.active||(null===(e=i.url)||void 0===e?void 0:e.startsWith("chrome://")))return;const o=yield chrome.tabs.captureVisibleTab(i.windowId,{format:"jpeg",quality:50});if(o){n.set(t,o),yield u(t,o);const e={id:i.id,title:i.title,url:i.url,favIconUrl:i.favIconUrl,thumbnailUrl:o};yield h(t,e)}}catch(e){console.warn(`Could not capture tab ${t}: ${e.message}`)}})},e.preloadAllTabThumbnails=function(){return i(this,void 0,void 0,function*(){try{const t=(yield chrome.windows.getAll({populate:!0})).map(t=>i(this,void 0,void 0,function*(){if(!t.tabs)return;const e=t.tabs.find(t=>t.active);if(e&&e.id&&e.url&&!e.url.startsWith("chrome://"))try{const i=yield chrome.tabs.captureVisibleTab(t.id,{format:"jpeg",quality:40});if(i&&e.id){n.set(e.id,i),yield u(e.id,i);const t={id:e.id,title:e.title,url:e.url,favIconUrl:e.favIconUrl,thumbnailUrl:i};yield h(e.id,t)}}catch(t){}for(const e of t.tabs)if(e.id&&e.url&&!e.url.startsWith("chrome://"))try{const t={id:e.id,title:e.title,url:e.url,favIconUrl:e.favIconUrl,thumbnailUrl:void 0};yield h(e.id,t)}catch(t){}}));yield Promise.allSettled(t)}catch(t){}})};let o=[];const n=new Map;let r=!1;const a="mruTabIds",c="tabThumbnails",l="tabData";function s(){return i(this,void 0,void 0,function*(){const t=yield chrome.tabs.query({}),e=yield chrome.storage.local.get([a,c,l]);if(e[a]){const i=new Set(t.map(t=>t.id));o=e[a].filter(t=>i.has(t));const n=new Set(o),r=t.filter(t=>t.id&&!n.has(t.id));o=[...o,...r.map(t=>t.id)]}else o=t.map(t=>t.id);d();const i=new Set(t.map(t=>t.id)),s=new Set(i);if(e[c]){const t=e[c];for(const[e,o]of Object.entries(t)){const t=parseInt(e,10);i.has(t)&&n.set(t,o)}const o={};for(const[e,i]of Object.entries(t)){const t=parseInt(e,10);s.has(t)&&(o[e]=i)}yield chrome.storage.local.set({[c]:o})}if(e[l]){const t=e[l],i={};for(const[e,o]of Object.entries(t)){const t=parseInt(e,10);s.has(t)&&(i[e]=o)}yield chrome.storage.local.set({[l]:i})}r=!0})}function d(){chrome.storage.local.set({[a]:o})}function u(t,e){return i(this,void 0,void 0,function*(){try{const i=(yield chrome.storage.local.get(c))[c]||{};i[t.toString()]=e,yield chrome.storage.local.set({[c]:i})}catch(t){console.warn(`Could not save thumbnail to storage: ${t.message}`)}})}function h(t,e){return i(this,void 0,void 0,function*(){try{const i=(yield chrome.storage.local.get(l))[l]||{};i[t.toString()]=e,yield chrome.storage.local.set({[l]:i})}catch(t){console.warn(`Could not save tab data to storage: ${t.message}`)}})}},922:function(t,e,i){var o,n=this&&this.__createBinding||(Object.create?function(t,e,i,o){void 0===o&&(o=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,o,n)}:function(t,e,i,o){void 0===o&&(o=i),t[o]=e[i]}),r=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||(o=function(t){return o=Object.getOwnPropertyNames||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[e.length]=i);return e},o(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i=o(t),a=0;a<i.length;a++)"default"!==i[a]&&n(e,t,i[a]);return r(e,t),e}),c=this&&this.__awaiter||function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function a(t){try{l(o.next(t))}catch(t){r(t)}}function c(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(a,c)}l((o=o.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const l=a(i(795));chrome.runtime.onStartup.addListener(()=>c(void 0,void 0,void 0,function*(){yield l.initializeMruList(),setTimeout(()=>l.preloadAllTabThumbnails(),1e3)})),chrome.runtime.onInstalled.addListener(()=>c(void 0,void 0,void 0,function*(){yield l.initializeMruList(),setTimeout(()=>l.preloadAllTabThumbnails(),1e3)})),chrome.tabs.onActivated.addListener(t=>c(void 0,void 0,void 0,function*(){l.updateMruList(t.tabId),yield l.captureAndCacheTab(t.tabId)})),chrome.tabs.onUpdated.addListener((t,e,i)=>c(void 0,void 0,void 0,function*(){"complete"===e.status&&i.active&&i.url&&!i.url.startsWith("chrome://")&&(yield l.captureAndCacheTab(t))})),chrome.tabs.onRemoved.addListener(t=>l.removeTabFromMru(t)),chrome.tabs.onCreated.addListener(t=>c(void 0,void 0,void 0,function*(){t.id&&l.updateMruList(t.id),t.id&&t.url&&!t.url.startsWith("chrome://")&&t.active&&setTimeout(()=>c(void 0,void 0,void 0,function*(){const e=yield chrome.tabs.get(t.id);e.active&&"complete"===e.status&&(yield l.captureAndCacheTab(t.id))}),500)})),chrome.runtime.onConnect.addListener(t=>{t.name}),chrome.commands.onCommand.addListener(t=>c(void 0,void 0,void 0,function*(){if("alt-q-switch"!==t)return;const[e]=yield chrome.tabs.query({active:!0,currentWindow:!0});if(!(!(null==e?void 0:e.id)||e.url&&e.url.startsWith("chrome://")))try{yield chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js"]});const t={type:"shortcut-pressed"};chrome.tabs.sendMessage(e.id,t)}catch(t){console.warn(`Alt+Q: Could not inject script: ${t.message}`)}})),chrome.runtime.onMessage.addListener((t,e,i)=>{if("capture-and-get-list"===t.type)return c(void 0,void 0,void 0,function*(){yield l.captureAndCacheTab(e.tab.id);const t=yield l.getTabDetails();i(t),l.preloadAllTabThumbnails().catch(()=>{})}),!0;"switch-to-tab"===t.type&&chrome.tabs.update(t.tabId,{active:!0})})}},e={};!function i(o){var n=e[o];if(void 0!==n)return n.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,i),r.exports}(922)})();