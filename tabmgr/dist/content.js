(()=>{"use strict";var t={411:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.cleanup=e.updateHighlight=e.createSwitcherUI=e.UIManager=void 0;const s=i(434),n=i(626),a=chrome.runtime.getURL("switcher.css");class r{static createSwitcherUI(t,e){this.cleanup(),this.injectCSS(),this.createOverlay(),this.renderTabs(t),this.updateHighlight(e)}static updateHighlight(t){const e=document.querySelectorAll(".alt-q-switcher-item"),i=document.getElementById(s.UI_IDS.LIST);e.forEach((e,i)=>{e.classList.toggle("highlighted",i===t)}),this.scrollToHighlightedItem(i,e[t])}static cleanup(){const t=document.getElementById(s.UI_IDS.OVERLAY);t&&t.remove();const e=document.getElementById(s.UI_IDS.STYLES);e&&e.remove()}static injectCSS(){if(document.getElementById(s.UI_IDS.STYLES))return;const t=document.createElement("link");t.id=s.UI_IDS.STYLES,t.rel="stylesheet",t.type="text/css",t.href=a,(document.head||document.documentElement).appendChild(t)}static createOverlay(){const t=document.createElement("div");t.id=s.UI_IDS.OVERLAY,t.innerHTML=`<div id="${s.UI_IDS.LIST}"></div>`,document.body.appendChild(t)}static renderTabs(t){const e=document.getElementById(s.UI_IDS.LIST);e&&(e.innerHTML=t.map(t=>this.createTabHTML(t)).join(""))}static createTabHTML(t){const e=!!t.thumbnailUrl;return`\n      <div class="alt-q-switcher-item">\n        <div class="alt-q-img-container">\n          <img src="${t.thumbnailUrl||t.favIconUrl||n.DEFAULT_FAVICON}" class="${e?"alt-q-preview-img":"alt-q-favicon"}" loading="lazy" alt=""/>\n        </div>\n        <span class="alt-q-title">${t.title||""}</span>\n      </div>\n    `}static scrollToHighlightedItem(t,e){if(!t||!e)return;const i=t.getBoundingClientRect(),s=e.getBoundingClientRect();s.top<i.top?e.scrollIntoView({behavior:"smooth",block:"start"}):s.bottom>i.bottom&&e.scrollIntoView({behavior:"smooth",block:"end"})}}e.UIManager=r,e.createSwitcherUI=(t,e)=>r.createSwitcherUI(t,e),e.updateHighlight=t=>r.updateHighlight(t),e.cleanup=()=>r.cleanup()},434:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.INIT_FLAG=e.KEY_CODES=e.UI_IDS=void 0,e.UI_IDS={OVERLAY:"alt-q-switcher-overlay",LIST:"alt-q-switcher-list",STYLES:"alt-q-switcher-styles"},e.KEY_CODES={ALT:"Alt",ALT_KEYCODE:18},e.INIT_FLAG="altQSwitcherInitialized"},583:function(t,e,i){var s,n=this&&this.__createBinding||(Object.create?function(t,e,i,s){void 0===s&&(s=i);var n=Object.getOwnPropertyDescriptor(e,i);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[i]}}),Object.defineProperty(t,s,n)}:function(t,e,i,s){void 0===s&&(s=i),t[s]=e[i]}),a=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),r=this&&this.__importStar||(s=function(t){return s=Object.getOwnPropertyNames||function(t){var e=[];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[e.length]=i);return e},s(t)},function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i=s(t),r=0;r<i.length;r++)"default"!==i[r]&&n(e,t,i[r]);return a(e,t),e}),c=this&&this.__awaiter||function(t,e,i,s){return new(i||(i=Promise))(function(n,a){function r(t){try{h(s.next(t))}catch(t){a(t)}}function c(t){try{h(s.throw(t))}catch(t){a(t)}}function h(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(r,c)}h((s=s.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const h=r(i(411)),l=i(724),o=i(434);class d{constructor(){this.stateManager=new l.StateManager,this.altUpListenerAdded=!1,this.isProcessing=!1,this.altReleased=!1,this.port=chrome.runtime.connect({name:"content-script-lifecycle"}),this.port.onDisconnect.addListener(()=>this.cleanup()),this.setupMessageListener()}static getInstance(){return d.instance||(d.instance=new d),d.instance}setupMessageListener(){chrome.runtime.onMessage.addListener(t=>{"shortcut-pressed"===t.type&&this.handleShortcutPress()})}handleShortcutPress(){return c(this,void 0,void 0,function*(){this.isProcessing||(this.altReleased=!1,this.setupAltKeyupListener(),this.stateManager.isVisible()?this.cycleHighlight():yield this.showSwitcher())})}showSwitcher(){return c(this,void 0,void 0,function*(){var t;this.isProcessing=!0;try{const e=yield this.fetchTabs();if(!e||0===e.length)return void(this.isProcessing=!1);if(this.altReleased){if(null===(t=e[1])||void 0===t?void 0:t.id){const t={type:"switch-to-tab",tabId:e[1].id};chrome.runtime.sendMessage(t).catch(()=>{})}return this.cleanup(),void(this.isProcessing=!1)}this.stateManager.setTabs(e),this.stateManager.show(),h.createSwitcherUI(e,this.stateManager.getState().highlightedIndex),this.setupEventListeners(),this.isProcessing=!1}catch(t){this.isProcessing=!1,t.message.includes("Extension context invalidated")&&this.cleanup()}})}fetchTabs(){return c(this,void 0,void 0,function*(){return chrome.runtime.sendMessage({type:"capture-and-get-list"})})}setupAltKeyupListener(){this.altUpListenerAdded||(window.addEventListener("keyup",this.handleAltUp.bind(this),{capture:!0}),this.altUpListenerAdded=!0)}setupEventListeners(){const t=document.getElementById("alt-q-switcher-overlay");t&&t.addEventListener("click",this.handleCancel.bind(this))}handleAltUp(t){this.isAltKey(t)&&(t.stopImmediatePropagation(),t.preventDefault(),this.altReleased=!0,this.stateManager.isVisible()&&this.selectTab(),this.cleanup())}isAltKey(t){return t.key===o.KEY_CODES.ALT||t.keyCode===o.KEY_CODES.ALT_KEYCODE}selectTab(){const t=this.stateManager.getHighlightedTab();if(null==t?void 0:t.id){const e={type:"switch-to-tab",tabId:t.id};chrome.runtime.sendMessage(e).catch(()=>{})}}handleCancel(t){"alt-q-switcher-overlay"===t.target.id&&this.cleanup()}cycleHighlight(){this.stateManager.cycleHighlight(),h.updateHighlight(this.stateManager.getState().highlightedIndex)}cleanup(){this.stateManager.isVisible()&&(h.cleanup(),this.stateManager.hide()),this.altUpListenerAdded&&(window.removeEventListener("keyup",this.handleAltUp.bind(this),{capture:!0}),this.altUpListenerAdded=!1),this.isProcessing=!1}}d.instance=null,window[o.INIT_FLAG]||(window[o.INIT_FLAG]=!0,window.__tabSwitcherInjected=!0,d.getInstance())},626:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_FAVICON=void 0,e.DEFAULT_FAVICON="https://i.imgur.com/8QZ7gV5.png"},724:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StateManager=void 0,e.StateManager=class{constructor(){this.state={isVisible:!1,tabs:[],highlightedIndex:0}}getState(){return Object.assign({},this.state)}setTabs(t){this.state.tabs=t,this.state.highlightedIndex=t.length>1?1:0}setHighlightedIndex(t){this.state.highlightedIndex=t}cycleHighlight(){0!==this.state.tabs.length&&(this.state.highlightedIndex=(this.state.highlightedIndex+1)%this.state.tabs.length)}show(){this.state.isVisible=!0}hide(){this.state.isVisible=!1,this.state.tabs=[],this.state.highlightedIndex=0}isVisible(){return this.state.isVisible}getHighlightedTab(){return this.state.tabs[this.state.highlightedIndex]}}}},e={};!function i(s){var n=e[s];if(void 0!==n)return n.exports;var a=e[s]={exports:{}};return t[s].call(a.exports,a,a.exports,i),a.exports}(583)})();